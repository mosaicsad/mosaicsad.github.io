<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans -en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="[comment]:&amp;lt;&amp;gt;(## A Look-alike Customer Model Based on Dynamic User and Advertisement Features) Project Member:  Wanxin Xu, Yunfei Gao, Ting Liu Email_address:WanxinXu2019@u.northwestern.edu,yunfe">
<meta property="og:type" content="article">
<meta property="og:title" content="A Look-alike Customer Model Based on Dynamic User and Advertisement Features">
<meta property="og:url" content="http://yoursite.com/2018/06/12/project/index.html">
<meta property="og:site_name" content="mosaicsad">
<meta property="og:description" content="[comment]:&amp;lt;&amp;gt;(## A Look-alike Customer Model Based on Dynamic User and Advertisement Features) Project Member:  Wanxin Xu, Yunfei Gao, Ting Liu Email_address:WanxinXu2019@u.northwestern.edu,yunfe">
<meta property="og:locale" content="zh-Hans -en">
<meta property="og:image" content="http://yoursite.com/2018/06/12/project/1.jpeg">
<meta property="og:image" content="http://yoursite.com/2018/06/12/project/2.jpeg">
<meta property="og:image" content="http://yoursite.com/2018/06/12/project/3.png">
<meta property="og:image" content="http://yoursite.com/2018/06/12/project/5.png">
<meta property="og:image" content="http://yoursite.com/2018/06/12/project/4.png">
<meta property="og:updated_time" content="2018-06-12T20:30:05.826Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="A Look-alike Customer Model Based on Dynamic User and Advertisement Features">
<meta name="twitter:description" content="[comment]:&amp;lt;&amp;gt;(## A Look-alike Customer Model Based on Dynamic User and Advertisement Features) Project Member:  Wanxin Xu, Yunfei Gao, Ting Liu Email_address:WanxinXu2019@u.northwestern.edu,yunfe">
<meta name="twitter:image" content="http://yoursite.com/2018/06/12/project/1.jpeg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: 'V6FO7XZQN4',
      apiKey: '7622b06f97b18239cdcc169d812594e9',
      indexName: 'blog_search',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/06/12/project/"/>





  <title>A Look-alike Customer Model Based on Dynamic User and Advertisement Features | mosaicsad</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans -en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">mosaicsad</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/12/project/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yunfei Gao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mosaicsad">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">A Look-alike Customer Model Based on Dynamic User and Advertisement Features</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-12T03:42:18-05:00">
                2018-06-12
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/12/project/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2018/06/12/project/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/06/12/project/" class="leancloud_visitors" data-flag-title="A Look-alike Customer Model Based on Dynamic User and Advertisement Features">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>[comment]:&lt;&gt;(## A Look-alike Customer Model Based on Dynamic User and Advertisement Features)</p>
<p><strong>Project Member:</strong>  Wanxin Xu, Yunfei Gao, Ting Liu</p>
<p><strong>Email_address:</strong><a href="mailto:WanxinXu2019@u.northwestern.edu" target="_blank" rel="noopener">WanxinXu2019@u.northwestern.edu</a>,<a href="mailto:yunfeigao2018@u.northwestern.edu" target="_blank" rel="noopener">yunfeigao2018@u.northwestern.edu</a>, <a href="mailto:tingliu2017@u.northwestern.edu" target="_blank" rel="noopener">tingliu2017@u.northwestern.edu</a></p>
<p><strong>Course Name:</strong> EECS 349 Machine Learning</p>
<p><strong>Instructor:</strong> Professor Doug Downey</p>
<p><strong>University Name:</strong> Northwestern University</p>
<h4 id="1-Overview-of-the-Task"><a href="#1-Overview-of-the-Task" class="headerlink" title="1.    Overview of the Task"></a>1.    Overview of the Task</h4><p>Look-alike models are used to classify larger users into smaller seed groups to create reach for advertisers. The users classified into a specific seed group will reflect the benchmark characteristics of the seed. In summary, look-alike modeling can be used to reach new prospects that look like a marketer’s best customers.Our task is to build a look-alike customer model on top of a set of user features and advertisement features. This project is from an online advertising algorithm competition. Look-alike model, based on a seed group (also known as seed packets) provided by advertisers can automatically calculate a similar group of people (known as an extended population). This online machine learning competition provides a dataset containing hundreds of seed groups, the advertisement features corresponding to the seed groups and the user features corresponding to mass user candidates.  The entire dataset is divided into a training set and a test set. The training set labels the users who belong to the seed package and the users who do not belong to the seed package (i.e. the positive and negative samples) as +1 and -1, respectively. The testing set will test whether the algorithm can accurately determine whether the user in the test set belongs to the corresponding seed package. The seed packets in training set and testing set are corresponding to each other.<br>In order to test whether the algorithm can understand user features and seed packets well, the results will include the score of how likely the user candidates belong to a specific seed group. The higher score indicates the higher potential of the candidate belonging to this seed group. </p>
<h4 id="2-Learners-and-Features"><a href="#2-Learners-and-Features" class="headerlink" title="2.    Learners and Features"></a>2.    Learners and Features</h4><p>We tried four learners which are random forests, k-nearest-neighbor, lightGBM and FFM.<br>The entire dataset includes four files which are training data, testing data, user features and advertisement(Ad) features and it is available at <a href="http://algo.qq.com/home/information/info.html" target="_blank" rel="noopener">http://algo.qq.com/home/information/info.html</a>.</p>
<p>Training data: Each row in the train.csv represents a training sample containing three attributes: “aid, uid, label” in the set. Among them, aid uniquely identifies an AD, and uid uniquely identifies one user. The value of the sample label is +1 or -1, where +1 represents the seed user, and -1 represents non-seed users. To simplify the problem, a seed package only corresponds to an AD aid, and the two are one-to-one correspondence.<br>Testing data: Each row in the test.csv represents a testing sample containing two attributes which are “aid, uid” with the same meaning as discussed above.<br>User feature: Each row in the userFeature.data represents features of one specific user. Missing attributes are recorded as “0”. The features to be used are listed in Table 1. </p>
<h6 id="Table-1-Advertisement-features"><a href="#Table-1-Advertisement-features" class="headerlink" title="Table 1 Advertisement features"></a><center><em>Table 1 Advertisement features</em></center></h6><p><img src="1.jpeg" alt="fail.."><br>Advertisement features are listed in the Table 2.</p>
<h6 id="Table-2-Advertisement-features"><a href="#Table-2-Advertisement-features" class="headerlink" title="Table 2 Advertisement features"></a><center><em>Table 2 Advertisement features</em></center></h6><p><img src="2.jpeg" alt="fail.."></p>
<h4 id="3-Key-results-of-Baseline-method"><a href="#3-Key-results-of-Baseline-method" class="headerlink" title="3. Key results of Baseline method"></a>3. Key results of Baseline method</h4><p>Because of the large size of the dataset, we first selected two subsets of the original dataset as our training set with a total of 14000 rows and a testing set of 6000 rows. There are some features as stated above which are represented in vectors of strings which cannot be directly relayed into the classifier. Therefore we had to first deal with the features with vector values. We used the CountVectorizier() from sklearn to transform strings to matrix representation.<br><img src="3.png" alt="fail.."></p>
<p><img src="5.png" alt="fail.."><br>As is shown in the table, the F1 score, accuracy, AUC of RF are all higher than kNN. However the confusion matrix indicates that RF just simply classified all the labels to the ‘0’ class which has the same performance of ZeroR. We imply that this comes from the huge imbalance of the dataset. The code is available at <a href="https://github.com/WanxinXu27/EECS349Project" target="_blank" rel="noopener">https://github.com/WanxinXu27/EECS349Project</a><br><img src="4.png" alt="fail.."><br>We extracted the feature importance information from the RF classifier and included the <strong>figure</strong> in this report. <strong>As is indicated in the figure, feature 1, feature 9, feature 0, which represent uid, LBS, aid, seem to be the three most importance features in the classification. It makes sense as the uid, aid and location should have strong impact on the classification.</strong></p>
<h4 id="4-Preliminary-Results-with-much-complicated-classifiers"><a href="#4-Preliminary-Results-with-much-complicated-classifiers" class="headerlink" title="4.    Preliminary Results with much complicated classifiers"></a>4.    Preliminary Results with much complicated classifiers</h4><p>The classifier discussed in class seemed not to perform well on this large, sparse dataset. Therefore we turned into other much complicated classifiers which are widely used recently.</p>
<h5 id="Light-GBM"><a href="#Light-GBM" class="headerlink" title="Light GBM"></a>Light GBM</h5><p>Light GBM is an implementation of gradient boosting decision tree with two novel techniques: gradient-based one-side sampling and exclusive feature bundling. It is a modified decision tree classifier with built-in gradient boosting. It has great compatibility with large datasets and is histogram based, i.e., it buckets continuous feature values into discrete bins which fasten the training procedure. Therefore we assume it would be suited for our look-alike classification task.</p>
<p>We tried the Light Gradient Boosting Machine which is a gradient boosting framework that uses tree based learning algorithms. The package is available at <a href="https://github.com/Microsoft/LightGBM" target="_blank" rel="noopener">https://github.com/Microsoft/LightGBM</a>. We treated <em>“LBS, age, carrier , consumptionAbility, education, gender, house, os, ct, marriageStatus, advertiserId, campaignId, creativeId, adCategoryId, productId, productType”</em> as one-hot features and <em>“appIdAction, appIdInstall, interest1, interest2, interest3, interest4, interest5, kw1, kw2, kw3, topic1, topic2, topic3”</em> as vector features. We sliced the whole training set into 20 segments and built and tested our model on each segment and calculated the average score based on all 20 segments. The overall accuracy on testing set is 0.717998 with LGBM parameters which are <em>num_leaves=31, reg_alpha=0.0, reg_lambda=1, max_depth=-1, n_estimators=1500, objective=’binary’, subsample=0.7, colsample_bytree=0.7, subsample_freq=1, learning_rate=0.05, min_child_weight=50, random_state=2018, n_jobs=-1.</em><br>However, it takes more than 48 hours to build the light gradient boosting decision trees on such big amount of data. </p>
<p><strong>Pros &amp; Cons of LightGBM</strong><br>LightGBM can also handle categorical features by taking the input of feature names. It does not convert to one-hot coding, and is much faster than one-hot coding. Thus, LGBM has a faster speed than xBoost.  LGBM uses a special algorithm to find the split value of categorical features. And LGBM uses leaf wise splits which lead to increase in complexity and may lead to over fitting. It can be overcome by specifying another parameter max-depth which specifies the depth to which splitting will occur. So, we have to set parameters carefully to avoid overfitting. </p>
<h5 id="FFM"><a href="#FFM" class="headerlink" title="FFM"></a>FFM</h5><p>We turned to other algorithms like Field-aware Factorization Machine (FFM). FFM is an upgraded version of Factorization Machine (FM), which is very powerful in sparse settings. In our project FFM is applied by using xlearn (<a href="https://github.com/aksnzhy/xlearn)" target="_blank" rel="noopener">https://github.com/aksnzhy/xlearn)</a>. We converted all the categorical features into one-hot encoding and discarded the attributes which have more than 90% missing data. We then fed the one-hot features, vector features into FFM and got a higher accuracy of 0.731189. We are now working on feature processing and selection. </p>
<p>Features are divided into three categories: one-hot features, vector features and continuous features.  By introducing the concept of field, FFM classifies attributes that have the same property to the same field. In simple terms, the numerical characteristics generated by the One-Hot encoding of the same categorical feature can all be put into the same field, including the user’s gender, occupation, and category preferences. Based on that, we did a preprocess to transform our data into the specific form before using xlearn. In xlearn we set parameters like that,  <em>param = {‘task’:’binary’, ‘lr’:0.01, ‘lambda’:0.001,’metric’: ‘auc’,’opt’:’ftrl’,’epoch’:5,’k’:4, ‘alpha’: 1.5, ‘beta’: 0.01, ‘lambda_1’: 0.0, ‘lambda_2’: 0.0}</em>. </p>
<p><strong>Pros &amp; cons of FFM</strong><br>From the theoretical analysis, FFM’s parameterization method has some significant advantages. It is particularly suitable for handling sample sparseness problems which is exactly suit for our problem and ensures better performance. And FFM is quite time economy, which only takes about 1 hour to complete the whole training things. Comparing with Light GBM, it saves a lot of time. </p>
<h4 id="5-Feature-combination"><a href="#5-Feature-combination" class="headerlink" title="5.    Feature combination"></a>5.    Feature combination</h4><p>The features we are using now are almost raw and we believe the result can be improved further if we can find a way to extract better features. Our current idea is to do feature combination by simple operations using Pandas. The code is also accessible at <a href="https://github.com/WanxinXu27/EECS349Project" target="_blank" rel="noopener">https://github.com/WanxinXu27/EECS349Project</a><br>After doing the combination our Light GBM accuracy increases into 0.738475 and FFM accuracy increase into 0.750324. As we can see, both methods increase about 2 percent accuracy. It shows that the feature combination is an important step to increase the accuracy of classification.<br>Why is can huge increase the accuracy? First, we choose to combine the most important features which we analyzed in our Baseline method. After we combine them, they have better ability to describe our whole dataset. Also, a key to success of one machine problem is to find the best feature to describe it. Those features can show a high robustness in any classification method. But after we combine some features, the dimension of our dataset increase rapidly. We have to wait more time to get the result. </p>
<h4 id="6-Future-work"><a href="#6-Future-work" class="headerlink" title="6. Future work"></a>6. Future work</h4><p>In the future, we will try NN method, which is another idea to continue our work. After that, we can do some machine learning stacking to fuse our models to get better result. </p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/07/Lightgbm/" rel="next" title="lightgbm 安装与报错处理">
                <i class="fa fa-chevron-left"></i> lightgbm 安装与报错处理
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Yunfei Gao</p>
              <p class="site-description motion-element" itemprop="description">This is a blog to share technology and interest things in mosaicsad's world. 我会去分享我想要分享的东西。说一说mosaicsad这个名字，mosaic的一天都是很happy的, sad只是因为在注册账号的那天mosaic被别人使用了，所以就在后面加了一个sad。感谢这个名字，从此之后我再也没有遇到重复的名字了～～</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Overview-of-the-Task"><span class="nav-number">1.</span> <span class="nav-text">1.    Overview of the Task</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Learners-and-Features"><span class="nav-number">2.</span> <span class="nav-text">2.    Learners and Features</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Table-1-Advertisement-features"><span class="nav-number">2.0.1.</span> <span class="nav-text">Table 1 Advertisement features</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Table-2-Advertisement-features"><span class="nav-number">2.0.2.</span> <span class="nav-text">Table 2 Advertisement features</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Key-results-of-Baseline-method"><span class="nav-number">3.</span> <span class="nav-text">3. Key results of Baseline method</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-Preliminary-Results-with-much-complicated-classifiers"><span class="nav-number">4.</span> <span class="nav-text">4.    Preliminary Results with much complicated classifiers</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Light-GBM"><span class="nav-number">4.1.</span> <span class="nav-text">Light GBM</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#FFM"><span class="nav-number">4.2.</span> <span class="nav-text">FFM</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-Feature-combination"><span class="nav-number">5.</span> <span class="nav-text">5.    Feature combination</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-Future-work"><span class="nav-number">6.</span> <span class="nav-text">6. Future work</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yunfei Gao</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    
      <script type="text/javascript">
      function renderGitment(){
        var gitment = new Gitmint({
            id: window.location.pathname, 
            owner: 'mosaicsad',
            repo: 'gitment-comments',
            
            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,
            
            oauth: {
            
            
                client_secret: 'c36a6fbdaa3f721db946d988f2bbfd5948f6da42',
            
                client_id: 'c0d90325ab1380b69ee3'
            }});
        gitment.render('gitment-container');
      }

      
      renderGitment();
      
      </script>
    







  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("aa1192iBQAR7HeuMh406D4UO-MdYXbMMI", "JmpgqkuHjg0LMkrKMsRg1NRU");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
